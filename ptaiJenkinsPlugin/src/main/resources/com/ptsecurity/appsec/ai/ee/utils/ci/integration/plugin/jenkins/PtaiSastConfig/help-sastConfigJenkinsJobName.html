<!-- http://hilite.me/ used to generate script HTML listing -->
<div>
    <p>Name of main SAST job. The job is a pipeline with two parameters:</p>
    <p>PTAI_PROJECT_NAME - defines name of project in the PT AI Viewer</p>
    <p>PTAI_NODE_NAME - defines name or tag of CI node where SAST is to be executed</p>
    <p>Groovy sandbox must be turned off. Basic recommended script is:</p>
    <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #2b91af">def</span> aicPath = <span style="color: #a31515">&#39;C:\\Program Files (x86)\\Positive Technologies\\Application Inspector Agent\\aic.exe&#39;</span>

node(<span style="color: #a31515">&quot;${PTAI_NODE_NAME}&quot;</span>) {
    <span style="color: #2b91af">def</span> retStatus = 0;

    stage(<span style="color: #a31515">&#39;SAST&#39;</span>) {
        <span style="color: #0000ff">if</span> (isUnix()) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;PT AI must be deployed on a Windows host&#39;</span>;
            <span style="color: #0000ff">return</span>;
        }
        cleanWs();

        batchScript = <span style="color: #a31515">&quot;\&quot;${aicPath}\&quot; &quot;</span>;
        batchScript += <span style="color: #a31515">&quot;--project-name \&quot;${PTAI_PROJECT_NAME}\&quot; &quot;</span>;
        batchScript += <span style="color: #a31515">&quot;--scan-target \&quot;${WORKSPACE}\\SCAN\&quot; &quot;</span>
        batchScript += <span style="color: #a31515">&quot;--reports \&quot;HTML|JSON\&quot; &quot;</span>
        batchScript += <span style="color: #a31515">&quot;--reports-folder \&quot;${WORKSPACE}\\REPORTS\&quot; &quot;</span>
        batchScript += <span style="color: #a31515">&quot;--restore-sources &quot;</span>
        batchScript += <span style="color: #a31515">&quot;--sync &quot;</span>

        retStatus = bat(script: batchScript, returnStatus: <span style="color: #0000ff">true</span>);
        println <span style="color: #a31515">&quot;AI return status ${retStatus}&quot;</span>;
        <span style="color: #0000ff">if</span> ((0 == retStatus) || (10 == retStatus) || (6 == retStatus))
            archiveArtifacts <span style="color: #a31515">&#39;REPORTS/*&#39;</span>;

        <span style="color: #0000ff">if</span> (0 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;SUCCESS&quot;</span>;
            println <span style="color: #a31515">&#39;SAST policy assessment OK&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (10 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;FAILURE&quot;</span>;
            println <span style="color: #a31515">&#39;SAST policy assessment failed&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (-1 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;Another AI instance started already&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (2 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;Scan folder not found&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (3 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;AI license problem&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (4 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;Project not found&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (5 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;UNSTABLE&quot;</span>;
            println <span style="color: #a31515">&#39;Project settings error&#39;</span>;
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (6 == retStatus) {
            currentBuild.result = <span style="color: #a31515">&quot;SUCCESS&quot;</span>;
            println <span style="color: #a31515">&#39;Minor errors during scan&#39;</span>;
        } <span style="color: #0000ff">else</span> {
            currentBuild.result = <span style="color: #a31515">&quot;FAILURE&quot;</span>;
            println <span style="color: #a31515">&#39;Unknown problem&#39;</span>;
        }
        cleanWs();
    }
}
</pre></div>
</div>
