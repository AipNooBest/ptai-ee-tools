podTemplate(yaml: '''
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: jnlp
    image: dockerhub.domain.org/jenkins/inbound-agent:domain
  - name: gradle
    image: dockerhub.domain.org/gradle:7.1.1-jdk11-domain
    command:
    - sleep
    args:
    - infinity
''') {
    node(POD_LABEL) {
        git branch: "${branch}", url: 'https://github.com/ZhukovAN/ptai-ee-tools.git'
        container('gradle') {
            sh "gradle build -P jenkinsVersion=${jenkinsVersion} -P teamcityVersion=${teamcityVersion}"
        }
        archiveArtifacts artifacts: 'ptai-cli-plugin/build/libs/ptai-cli-plugin.jar, ptai-jenkins-plugin/build/libs/ptai-jenkins-plugin.hpi, ptai-teamcity-plugin/ptai-teamcity-plugin-server/build/distributions/ptai-teamcity-plugin.zip', followSymlinks: false
    }
}
